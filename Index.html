<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="IronLog">
<title>IronLog</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@700&display=swap');

- { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

:root {
–bg: #0a0a0c;
–card: #141418;
–accent: #e8f54a;
–accent-dim: #b8c53a;
–text: #e8e8ec;
–text-dim: #7a7a88;
–border: #2a2a32;
–danger: #ff4757;
–success: #2ed573;
–input-bg: #1c1c24;
}

body {
background: var(–bg);
color: var(–text);
font-family: ‘DM Sans’, -apple-system, sans-serif;
min-height: 100vh;
max-width: 480px;
margin: 0 auto;
padding: 0 0 100px 0;
-webkit-font-smoothing: antialiased;
}

.page { padding: 20px; display: none; }
.page.active { display: block; }

h1 { font-family: ‘Space Mono’, monospace; font-size: 28px; letter-spacing: -1px; }
h1 span { color: var(–accent); }
.subtitle { color: var(–text-dim); font-size: 14px; margin-top: 4px; }

.section-title {
font-size: 13px; color: var(–text-dim); text-transform: uppercase;
letter-spacing: 1.5px; margin-bottom: 12px; font-weight: 600;
}

.btn {
border: none; border-radius: 12px; padding: 14px 24px; font-size: 16px;
font-weight: 600; cursor: pointer; font-family: ‘DM Sans’, sans-serif;
transition: all 0.15s; width: 100%; display: block; text-align: center;
}
.btn-primary { background: var(–accent); color: #0a0a0c; }
.btn-primary:active { background: var(–accent-dim); }
.btn-primary:disabled { opacity: 0.4; }
.btn-secondary { background: var(–card); color: var(–text); border: 1px solid var(–border); }
.btn-small { padding: 8px 14px; font-size: 13px; border-radius: 20px; width: auto; display: inline-block; }
.btn-back {
background: none; border: none; color: var(–text-dim); font-size: 15px;
cursor: pointer; padding: 0; margin-bottom: 16px; font-family: ‘DM Sans’, sans-serif;
}

.card {
background: var(–card); border-radius: 14px; padding: 14px 16px;
margin-bottom: 8px; border: 1px solid var(–border);
}
.card-title { font-weight: 600; font-size: 15px; }
.card-sub { color: var(–text-dim); font-size: 13px; margin-top: 2px; }
.card-row { display: flex; justify-content: space-between; align-items: center; }

input, textarea {
background: var(–input-bg); border: 1px solid var(–border); border-radius: 10px;
padding: 12px 14px; font-size: 16px; color: var(–text);
font-family: ‘DM Sans’, sans-serif; outline: none; width: 100%;
}
input:focus, textarea:focus { border-color: var(–accent); }
textarea { min-height: 220px; resize: vertical; line-height: 1.6; }
input[type=“number”] { text-align: center; padding: 10px 12px; font-size: 15px; }

.set-grid {
display: grid; grid-template-columns: 36px 1fr 1fr 32px;
gap: 8px; align-items: center;
}
.set-label { font-size: 12px; color: var(–text-dim); text-align: center; }
.set-num { font-size: 14px; color: var(–text-dim); text-align: center; font-weight: 600; }
.set-remove { background: none; border: none; color: var(–text-dim); font-size: 16px; cursor: pointer; padding: 0; }

.add-set-btn {
background: none; border: 1px dashed var(–border); border-radius: 8px;
padding: 8px; width: 100%; color: var(–text-dim); font-size: 13px;
cursor: pointer; margin-top: 6px; font-family: ‘DM Sans’, sans-serif;
}

.exercise-card { border-radius: 16px; padding: 16px; margin-bottom: 12px; }
.exercise-card h3 { margin: 0 0 12px; font-size: 16px; font-weight: 600; }

.action-row { display: flex; gap: 10px; margin-top: 20px; }
.action-row .btn { flex: 1; }
.action-row .btn-primary { flex: 2; }

.template-delete, .workout-delete {
background: none; border: none; font-size: 18px; cursor: pointer; padding: 4px 8px;
}
.template-delete { color: var(–text-dim); }
.workout-delete { color: var(–danger); font-size: 13px; font-family: ‘DM Sans’, sans-serif; }

.rest-toast {
position: fixed; top: 16px; left: 50%; transform: translateX(-50%);
background: var(–accent); color: #0a0a0c; padding: 10px 24px;
border-radius: 40px; font-family: ‘Space Mono’, monospace;
font-size: 20px; font-weight: 700; z-index: 1000;
box-shadow: 0 4px 24px rgba(232,245,74,0.27); display: none;
}
.rest-toast.visible { display: block; }

.progress-bar-container { display: flex; gap: 4px; align-items: flex-end; height: 120px; margin-bottom: 24px; }
.progress-bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; }
.progress-bar-val { font-size: 10px; color: var(–text-dim); }
.progress-bar {
width: 100%; background: var(–accent); border-radius: 4px; min-height: 4px;
}
.progress-bar-date { font-size: 9px; color: var(–text-dim); transform: rotate(-45deg); white-space: nowrap; }

.detail-set { display: flex; gap: 12px; font-size: 14px; color: var(–text-dim); margin-bottom: 4px; }
.detail-set .label { width: 50px; }
.detail-set .val { color: var(–text); }

.header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.view-all { background: none; border: none; color: var(–accent); font-size: 13px; cursor: pointer; font-family: ‘DM Sans’, sans-serif; }

.chips { display: flex; flex-wrap: wrap; gap: 8px; }

.rest-btn-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

.flex-fill { flex: 1; cursor: pointer; }

@media (prefers-color-scheme: light) {
/* Keeping dark theme always for gym vibe */
}
</style>

</head>
<body>

<div class="rest-toast" id="restToast">Rest: <span id="restDisplay">0:00</span></div>

<!-- HOME PAGE -->

<div class="page active" id="page-home">
  <div style="margin-bottom:32px">
    <h1>IRON<span>LOG</span></h1>
    <p class="subtitle">Track your lifts. See your progress.</p>
  </div>

  <button class="btn btn-primary" style="font-size:17px;padding:16px 24px;margin-bottom:16px" onclick="showPage('paste')">
    + New Workout
  </button>

  <div id="templates-section" style="margin-bottom:32px;display:none">
    <p class="section-title">Saved Templates</p>
    <div id="templates-list"></div>
  </div>

  <div id="recent-section" style="display:none">
    <div class="header-row">
      <p class="section-title" style="margin:0">Recent Workouts</p>
      <button class="view-all" onclick="showPage('history')">View All →</button>
    </div>
    <div id="recent-list"></div>
  </div>

  <div id="progress-section" style="margin-top:32px;display:none">
    <p class="section-title">Progress Tracker</p>
    <div class="chips" id="exercise-chips"></div>
  </div>
</div>

<!-- PASTE PAGE -->

<div class="page" id="page-paste">
  <button class="btn-back" onclick="showPage('home')">← Back</button>
  <h2 style="font-size:22px;margin:0 0 20px;font-weight:700">New Workout</h2>
  <input type="text" id="workout-name" placeholder="Workout name (e.g. Push Day)" style="margin-bottom:12px">
  <textarea id="paste-area" placeholder="Paste your workout here...

Examples:
Bench Press 4x8
Incline DB Press 3x10
Cable Flyes 3x12

Or just list exercises:
Squats
Leg Press
Romanian Deadlifts”></textarea>
<button class="btn btn-primary" style="margin-top:16px" onclick="handleParse()" id="start-btn">Start Workout →</button>

</div>

<!-- ACTIVE WORKOUT PAGE -->

<div class="page" id="page-active">
  <div class="rest-btn-row">
    <div>
      <h2 style="font-size:22px;font-weight:700" id="active-title"></h2>
      <p class="subtitle" id="active-date"></p>
    </div>
    <button class="btn btn-secondary btn-small" onclick="startRest(90)">⏱ Rest</button>
  </div>
  <div id="exercises-container"></div>
  <div class="action-row">
    <button class="btn btn-secondary" onclick="discardWorkout()">Discard</button>
    <button class="btn btn-primary" onclick="saveWorkout()">Save Workout ✓</button>
  </div>
</div>

<!-- HISTORY PAGE -->

<div class="page" id="page-history">
  <button class="btn-back" onclick="showPage('home')">← Back</button>
  <h2 style="font-size:22px;margin:0 0 20px;font-weight:700">All Workouts</h2>
  <div id="history-list"></div>
</div>

<!-- DETAIL PAGE -->

<div class="page" id="page-detail">
  <button class="btn-back" onclick="showPage('history')">← Back</button>
  <h2 style="font-size:22px;margin:0;font-weight:700" id="detail-title"></h2>
  <p class="subtitle" style="margin-bottom:20px" id="detail-date"></p>
  <div id="detail-exercises"></div>
</div>

<!-- PROGRESS PAGE -->

<div class="page" id="page-progress">
  <button class="btn-back" onclick="showPage('home')">← Back</button>
  <h2 style="font-size:22px;margin:0 0 4px;font-weight:700" id="progress-title"></h2>
  <p class="subtitle" style="margin-bottom:20px">Progress over time</p>
  <div id="progress-content"></div>
</div>

<script>
// ========== DATA ==========
const STORAGE_KEY = 'ironlog-data';

function loadData() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : { workouts: [], templates: [] };
  } catch { return { workouts: [], templates: [] }; }
}

function saveData(data) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch(e) { console.error(e); }
}

let appData = loadData();
let activeWorkout = null;
let currentDetail = null;
let restInterval = null;
let restSeconds = 0;

// ========== NAVIGATION ==========
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  window.scrollTo(0, 0);

  if (name === 'home') renderHome();
  if (name === 'history') renderHistory();
}

// ========== FORMATTING ==========
function formatDate(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}
function formatDateShort(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// ========== PARSER ==========
function parseWorkout(text) {
  const lines = text.split('\n').filter(l => l.trim());
  const exercises = [];
  for (const line of lines) {
    const trimmed = line.trim();
    if (!trimmed) continue;
    const setsMatch = trimmed.match(/(\d+)\s*[xX×]\s*(\d+)/);
    if (setsMatch) {
      let name = trimmed.replace(/(\d+)\s*[xX×]\s*(\d+)/, '').replace(/[-–—:]/g, '').trim();
      const setCount = parseInt(setsMatch[1]);
      const repCount = parseInt(setsMatch[2]);
      exercises.push({
        name: name || 'Exercise ' + (exercises.length + 1),
        sets: Array.from({ length: setCount }, () => ({ weight: '', reps: repCount.toString() }))
      });
    } else {
      const name = trimmed.replace(/^[-–—•*]\s*/, '').replace(/:\s*$/, '');
      exercises.push({
        name,
        sets: [{ weight: '', reps: '' }, { weight: '', reps: '' }, { weight: '', reps: '' }]
      });
    }
  }
  return exercises;
}

// ========== REST TIMER ==========
function startRest(seconds) {
  if (restInterval) clearInterval(restInterval);
  restSeconds = seconds;
  const toast = document.getElementById('restToast');
  toast.classList.add('visible');
  updateRestDisplay();
  restInterval = setInterval(() => {
    restSeconds--;
    if (restSeconds <= 0) {
      clearInterval(restInterval);
      restInterval = null;
      toast.classList.remove('visible');
      if (navigator.vibrate) navigator.vibrate(200);
    }
    updateRestDisplay();
  }, 1000);
}

function updateRestDisplay() {
  const m = Math.floor(restSeconds / 60);
  const s = (restSeconds % 60).toString().padStart(2, '0');
  document.getElementById('restDisplay').textContent = m + ':' + s;
}

// ========== HOME ==========
function renderHome() {
  // Templates
  const tSec = document.getElementById('templates-section');
  const tList = document.getElementById('templates-list');
  if (appData.templates.length > 0) {
    tSec.style.display = 'block';
    tList.innerHTML = appData.templates.map((t, i) => `
      <div class="card card-row">
        <div class="flex-fill" onclick="loadTemplate(${i})">
          <div class="card-title">${esc(t.name)}</div>
          <div class="card-sub">${t.exercises.length} exercises</div>
        </div>
        <button class="template-delete" onclick="event.stopPropagation();deleteTemplate(${i})">×</button>
      </div>
    `).join('');
  } else {
    tSec.style.display = 'none';
  }

  // Recent workouts
  const rSec = document.getElementById('recent-section');
  const rList = document.getElementById('recent-list');
  if (appData.workouts.length > 0) {
    rSec.style.display = 'block';
    rList.innerHTML = appData.workouts.slice(0, 5).map((w, i) => `
      <div class="card" style="cursor:pointer" onclick="showDetail(${i})">
        <div class="card-row">
          <div class="card-title">${esc(w.name)}</div>
          <div class="card-sub">${formatDate(w.date)}</div>
        </div>
        <div class="card-sub" style="margin-top:4px">${w.exercises.map(e => esc(e.name)).join(' · ')}</div>
      </div>
    `).join('');
  } else {
    rSec.style.display = 'none';
  }

  // Progress chips
  const pSec = document.getElementById('progress-section');
  const chips = document.getElementById('exercise-chips');
  const names = [...new Set(appData.workouts.flatMap(w => w.exercises.map(e => e.name)))];
  if (names.length > 0) {
    pSec.style.display = 'block';
    chips.innerHTML = names.slice(0, 12).map(n => `
      <button class="btn btn-secondary btn-small" onclick="showProgress('${esc(n)}')">${esc(n)}</button>
    `).join('');
  } else {
    pSec.style.display = 'none';
  }
}

// ========== PASTE & PARSE ==========
function handleParse() {
  const text = document.getElementById('paste-area').value;
  const name = document.getElementById('workout-name').value || 'Workout';
  if (!text.trim()) return;

  const exercises = parseWorkout(text);
  if (exercises.length === 0) return;

  activeWorkout = { date: new Date().toISOString(), name, exercises };
  renderActiveWorkout();
  showPage('active');
}

// ========== ACTIVE WORKOUT ==========
function renderActiveWorkout() {
  if (!activeWorkout) return;
  document.getElementById('active-title').textContent = activeWorkout.name;
  document.getElementById('active-date').textContent = formatDate(activeWorkout.date);

  const container = document.getElementById('exercises-container');
  container.innerHTML = activeWorkout.exercises.map((ex, ei) => `
    <div class="card exercise-card">
      <h3>${esc(ex.name)}</h3>
      <div class="set-grid" style="margin-bottom:4px">
        <div class="set-label">SET</div>
        <div class="set-label">WEIGHT</div>
        <div class="set-label">REPS</div>
        <div></div>
      </div>
      ${ex.sets.map((s, si) => `
        <div class="set-grid" style="margin-bottom:6px">
          <div class="set-num">${si + 1}</div>
          <input type="number" inputmode="decimal" placeholder="lbs" value="${esc(s.weight)}"
            onchange="updateSet(${ei},${si},'weight',this.value)">
          <input type="number" inputmode="numeric" placeholder="reps" value="${esc(s.reps)}"
            onchange="updateSet(${ei},${si},'reps',this.value)">
          <button class="set-remove" onclick="removeSet(${ei},${si})">×</button>
        </div>
      `).join('')}
      <button class="add-set-btn" onclick="addSet(${ei})">+ Add Set</button>
    </div>
  `).join('');
}

function updateSet(exIdx, setIdx, field, value) {
  activeWorkout.exercises[exIdx].sets[setIdx][field] = value;
}

function addSet(exIdx) {
  const sets = activeWorkout.exercises[exIdx].sets;
  const last = sets[sets.length - 1];
  sets.push({ weight: last?.weight || '', reps: last?.reps || '' });
  renderActiveWorkout();
}

function removeSet(exIdx, setIdx) {
  if (activeWorkout.exercises[exIdx].sets.length > 1) {
    activeWorkout.exercises[exIdx].sets.splice(setIdx, 1);
    renderActiveWorkout();
  }
}

function saveWorkout() {
  appData.workouts.unshift(activeWorkout);

  // Save template if new
  if (!appData.templates.find(t => t.name === activeWorkout.name)) {
    appData.templates.unshift({
      name: activeWorkout.name,
      exercises: activeWorkout.exercises.map(e => ({
        name: e.name,
        sets: e.sets.map(s => ({ weight: '', reps: s.reps }))
      }))
    });
  }

  saveData(appData);
  activeWorkout = null;
  document.getElementById('paste-area').value = '';
  document.getElementById('workout-name').value = '';
  showPage('home');
}

function discardWorkout() {
  if (confirm('Discard this workout?')) {
    activeWorkout = null;
    showPage('home');
  }
}

// ========== TEMPLATES ==========
function loadTemplate(idx) {
  const t = appData.templates[idx];
  activeWorkout = {
    date: new Date().toISOString(),
    name: t.name,
    exercises: JSON.parse(JSON.stringify(t.exercises))
  };
  renderActiveWorkout();
  showPage('active');
}

function deleteTemplate(idx) {
  appData.templates.splice(idx, 1);
  saveData(appData);
  renderHome();
}

// ========== HISTORY ==========
function renderHistory() {
  const list = document.getElementById('history-list');
  if (appData.workouts.length === 0) {
    list.innerHTML = '<p style="color:var(--text-dim)">No workouts yet.</p>';
    return;
  }
  list.innerHTML = appData.workouts.map((w, i) => `
    <div class="card card-row">
      <div class="flex-fill" onclick="showDetail(${i})">
        <div class="card-title">${esc(w.name)}</div>
        <div class="card-sub">${formatDate(w.date)} · ${w.exercises.length} exercises</div>
      </div>
      <button class="workout-delete" onclick="event.stopPropagation();deleteWorkout(${i})">Delete</button>
    </div>
  `).join('');
}

function deleteWorkout(idx) {
  if (confirm('Delete this workout?')) {
    appData.workouts.splice(idx, 1);
    saveData(appData);
    renderHistory();
  }
}

// ========== DETAIL ==========
function showDetail(idx) {
  currentDetail = idx;
  const w = appData.workouts[idx];
  document.getElementById('detail-title').textContent = w.name;
  document.getElementById('detail-date').textContent = formatDate(w.date);

  document.getElementById('detail-exercises').innerHTML = w.exercises.map(ex => `
    <div class="card" style="margin-bottom:10px">
      <div class="card-title" style="margin-bottom:8px">${esc(ex.name)}</div>
      ${ex.sets.map((s, j) => `
        <div class="detail-set">
          <span class="label" style="color:var(--text-dim)">Set ${j + 1}</span>
          <span class="val">${s.weight ? s.weight + ' lbs' : '—'}</span>
          <span style="color:var(--text-dim)">×</span>
          <span class="val">${s.reps || '—'} reps</span>
        </div>
      `).join('')}
    </div>
  `).join('');

  showPage('detail');
}

// ========== PROGRESS ==========
function showProgress(exerciseName) {
  document.getElementById('progress-title').textContent = exerciseName;

  const history = [];
  for (const w of appData.workouts) {
    for (const e of w.exercises) {
      if (e.name.toLowerCase() === exerciseName.toLowerCase()) {
        let bestSet = { weight: 0, reps: 0, vol: 0 };
        let totalVol = 0;
        for (const s of e.sets) {
          const wt = parseFloat(s.weight) || 0;
          const rp = parseInt(s.reps) || 0;
          const v = wt * rp;
          totalVol += v;
          if (v > bestSet.vol) bestSet = { weight: wt, reps: rp, vol: v };
        }
        history.push({ date: w.date, bestSet, totalVol, sets: e.sets });
      }
    }
  }
  history.reverse();

  const content = document.getElementById('progress-content');

  if (history.length === 0) {
    content.innerHTML = '<p style="color:var(--text-dim)">No data yet.</p>';
    showPage('progress');
    return;
  }

  const maxVol = Math.max(...history.map(h => h.totalVol));
  const recent = history.slice(-15);

  let html = `
    <div style="margin-bottom:24px">
      <p class="section-title">Total Volume (lbs)</p>
      <div class="progress-bar-container">
        ${recent.map((h, i) => {
          const pct = maxVol > 0 ? (h.totalVol / maxVol) * 80 : 4;
          const opacity = 0.6 + (i / recent.length) * 0.4;
          return `
            <div class="progress-bar-col">
              <div class="progress-bar-val">${h.totalVol > 0 ? h.totalVol : ''}</div>
              <div class="progress-bar" style="height:${pct}px;opacity:${opacity}"></div>
              <div class="progress-bar-date">${formatDateShort(h.date)}</div>
            </div>
          `;
        }).join('')}
      </div>
    </div>

    <p class="section-title">Best Set Per Session</p>
    ${history.map(h => `
      <div class="card card-row" style="margin-bottom:6px">
        <span style="color:var(--text-dim);font-size:13px">${formatDate(h.date)}</span>
        <span style="font-weight:600;font-size:15px">
          <span style="color:var(--accent)">${h.bestSet.weight} lbs</span>
          <span style="color:var(--text-dim)"> × </span>
          ${h.bestSet.reps} reps
        </span>
      </div>
    `).join('')}
  `;

  content.innerHTML = html;
  showPage('progress');
}

// ========== UTILS ==========
function esc(str) {
  if (!str) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

// Init
renderHome();
</script>

</body>
</html>
